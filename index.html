<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¿ãƒƒãƒ—RPG å®Œå…¨ç‰ˆ</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{background:#111;color:#fff;font-family:sans-serif;text-align:center;margin:0;padding:15px}
button{font-size:16px;padding:12px 20px;margin:4px}
#tapBtn{font-size:26px;padding:28px 60px}
.hidden{display:none!important}
.boss{font-size:80px}
.player{font-size:60px}
.hp-bar{width:80%;height:18px;background:#333;margin:10px auto;border-radius:10px}
.hp{height:100%;background:red}
.overlay{
 position:fixed;inset:0;background:rgba(0,0,0,.9);
 display:flex;justify-content:center;align-items:center;
 font-size:22px;z-index:999;text-align:center;padding:20px;overflow:auto
}
.spin{font-size:80px;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.cut{animation:flash .4s alternate 6}
@keyframes flash{from{background:#000}to{background:#400}}
.lr{color:gold;font-weight:bold}
.ur{color:#ffd700}
.hr{color:#ff9966}
</style>
</head>
<body>

<h1>ğŸ”¥ ã‚¿ãƒƒãƒ—RPG ğŸ”¥</h1>
<p>ğŸ’° <span id="coin"></span> / ğŸ’ <span id="dia"></span></p>
<p>âš” æ”»æ’ƒåŠ› +<span id="atk"></span></p>
<div class="player" id="player">ğŸ™‚</div>

<!-- ã‚¬ãƒãƒ£ -->
<button onclick="drawGacha()">ğŸ°</button>
<button onclick="drawGacha10()">ğŸ°10</button>
<button onclick="drawDiaGacha()">ğŸ’</button>
<button onclick="drawDiaGacha10()">ğŸ’10</button>
<br>
<input id="diaInput" type="number" min="1" placeholder="äº¤æ›ğŸ’æ•°">
<button onclick="exchangeDia()">äº¤æ›</button>
<button onclick="showDex()">ğŸ“– å›³é‘‘</button>

<hr>

<button id="rushBtn" onclick="startRush()">ğŸ”¥ ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥ ğŸ”¥</button>

<div id="select">
<h3>ãƒœã‚¹é¸æŠ</h3>
<button onclick="startBattle('ã‚¹ãƒ©ã‚¤ãƒ ',100,'ğŸŸ¢',10)">ã‚¹ãƒ©ã‚¤ãƒ </button>
<button onclick="startBattle('ã‚ªãƒ¼ã‚¯',300,'ğŸ‘¹',20)">ã‚ªãƒ¼ã‚¯</button>
<button onclick="startBattle('ãƒ‰ãƒ©ã‚´ãƒ³',800,'ğŸ‰',50)">ãƒ‰ãƒ©ã‚´ãƒ³</button>
<button onclick="startBattle('ç¥ç«œ',5000,'ğŸ²âœ¨',500)">ç¥ç«œ</button>
<button onclick="startBattle('ç ´å£Šç¥',30000,'ğŸ’€',3000)">ç ´å£Šç¥</button>
<button onclick="startBattle('è™šç„¡ç‹',100000,'ğŸ‘',10000)">è™šç„¡ç‹</button>
<button onclick="startBattle('çµ‚ç„‰',300000,'ğŸŒ‘',50000)">çµ‚ç„‰</button>
</div>

<div id="game" class="hidden">
<h2 id="bossName"></h2>
<div class="boss" id="bossIcon"></div>
<div class="hp-bar"><div class="hp" id="hp"></div></div>
<p>HP <span id="hpText"></span></p>
<button id="tapBtn">æ”»æ’ƒ</button>
</div>

<div id="overlay" class="overlay hidden"></div>

<audio id="bgm" loop src="https://cdn.pixabay.com/audio/2022/03/15/audio_5c2e0a71d5.mp3"></audio>
<audio id="rareSE" src="https://cdn.pixabay.com/audio/2022/03/10/audio_c8c8a73467.mp3"></audio>

<script>
/* ===== ãƒ‡ãƒ¼ã‚¿ ===== */
let coin = Number(localStorage.getItem("coin")) || 0;
let dia  = Number(localStorage.getItem("dia")) || 0;
let atk  = Number(localStorage.getItem("atk")) || 0;
let dex  = JSON.parse(localStorage.getItem("dex") || "{}");

/* ===== DOM ===== */
const coinEl = document.getElementById("coin");
const diaEl  = document.getElementById("dia");
const atkEl  = document.getElementById("atk");
const overlay = document.getElementById("overlay");
const bgm = document.getElementById("bgm");
const rareSE = document.getElementById("rareSE");

/* ===== ä¿å­˜ ===== */
function save(){
 localStorage.setItem("coin",coin);
 localStorage.setItem("dia",dia);
 localStorage.setItem("atk",atk);
 localStorage.setItem("dex",JSON.stringify(dex));
 coinEl.textContent=coin;
 diaEl.textContent=dia;
 atkEl.textContent=atk.toFixed(1);
}
save();

/* ===== è¡¨ç¤º ===== */
function showMessage(html,time=2000){
 overlay.innerHTML=html;
 overlay.classList.remove("hidden");
 setTimeout(()=>overlay.classList.add("hidden"),time);
}

function cutIn(text){
 overlay.innerHTML=`<div class="cut">${text}</div>`;
 overlay.classList.remove("hidden");
 rareSE.play();
 setTimeout(()=>overlay.classList.add("hidden"),1200);
}

function gachaAnim(cb){
 overlay.innerHTML='<div class="spin">ğŸ°</div>';
 overlay.classList.remove("hidden");
 bgm.play();
 setTimeout(()=>{
  overlay.classList.add("hidden");
  cb();
 },1200);
}

/* ===== ã‚¬ãƒãƒ£ ===== */
function normalRoll(){
 const r=Math.random()*100;
 if(r<2) return ["LR",1.5];
 if(r<7) return ["UR",1];
 if(r<22)return ["HR",0.5];
 return ["R",0.1];
}

function drawGacha(){
 if(coin<100) return showMessage("ã‚³ã‚¤ãƒ³ä¸è¶³");
 coin-=100; save();
 gachaAnim(()=>{
  const g=normalRoll();
  atk+=g[1];
  dex[g[0]]=(dex[g[0]]||0)+1;
  save();
  showMessage(`${g[0]}<br>âš” +${g[1]}`);
  if(g[0]!=="R") setTimeout(()=>cutIn("âœ¨ "+g[0]+" âœ¨"),300);
 });
}

function drawGacha10(){
 if(coin<1000) return showMessage("ã‚³ã‚¤ãƒ³ä¸è¶³");
 coin-=1000; save();
 gachaAnim(()=>{
  let html="<h3>ğŸ°10é€£çµæœ</h3>";
  let rare=false;
  for(let i=0;i<10;i++){
   const g=normalRoll();
   atk+=g[1];
   dex[g[0]]=(dex[g[0]]||0)+1;
   html+=`<div>${g[0]} +${g[1]}</div>`;
   if(g[0]!=="R") rare=true;
  }
  save();
  showMessage(html,3500);
  if(rare) setTimeout(()=>cutIn("âœ¨ ãƒ¬ã‚¢ä»¥ä¸Šï¼ âœ¨"),400);
 });
}

function drawDiaGacha(){
 if(dia<1) return showMessage("ãƒ€ã‚¤ãƒ¤ä¸è¶³");
 dia--; save();
 gachaAnim(()=>{
  const r=Math.random()*100;
  let g = r<15?["DIVINE",10]:r<60?["UR",1]:["LR",1.5];
  atk+=g[1];
  dex[g[0]]=(dex[g[0]]||0)+1;
  save();
  showMessage(`ğŸ’ ${g[0]}<br>âš” +${g[1]}`);
  cutIn("ğŸ’ "+g[0]);
 });
}

function drawDiaGacha10(){
 if(dia<10) return showMessage("ãƒ€ã‚¤ãƒ¤ä¸è¶³");
 dia-=10; save();
 gachaAnim(()=>{
  let html="<h3>ğŸ’10é€£çµæœ</h3>";
  for(let i=0;i<10;i++){
   const r=Math.random()*100;
   let g=r<15?["DIVINE",10]:r<60?["UR",1]:["LR",1.5];
   atk+=g[1];
   dex[g[0]]=(dex[g[0]]||0)+1;
   html+=`<div>${g[0]} +${g[1]}</div>`;
  }
  save();
  showMessage(html,4000);
  cutIn("ğŸ’ 10é€£ï¼");
 });
}

/* ===== äº¤æ› ===== */
function exchangeDia(){
 const n=Number(diaInput.value);
 if(!Number.isInteger(n)||n<=0) return showMessage("æ•°ã‚’å…¥åŠ›");
 const cost=n*1000;
 if(coin<cost) return showMessage("ã‚³ã‚¤ãƒ³ä¸è¶³");
 coin-=cost; dia+=n; save();
 showMessage(`ğŸ’ +${n}<br>ğŸ’° -${cost}`);
}

/* ===== å›³é‘‘ ===== */
function showDex(){
 let h="<h2>ğŸ“– å›³é‘‘</h2>";
 if(Object.keys(dex).length===0) h+="<p>ã¾ã ç„¡ã—</p>";
 for(let k in dex) h+=`<div>${k} Ã— ${dex[k]}</div>`;
 showMessage(h,3500);
}

/* ===== ãƒãƒˆãƒ« ===== */
let bossHp,maxHp,reward,startTime;

function startBattle(n,h,i,r){
 document.getElementById("select").classList.add("hidden");
 document.getElementById("game").classList.remove("hidden");
 bossName.textContent=n;
 bossIcon.textContent=i;
 bossHp=maxHp=h;
 reward=r;
 startTime=Date.now();
 updateHp();
}

function updateHp(){
 hpText.textContent=Math.ceil(bossHp);
 hp.style.width=(bossHp/maxHp*100)+"%";
}

tapBtn.onclick=()=>{
 bossHp-=1+atk;
 updateHp();
 if(bossHp<=0){
  const t=((Date.now()-startTime)/1000).toFixed(2);
  coin+=reward; save();
  document.getElementById("game").classList.add("hidden");
  document.getElementById("select").classList.remove("hidden");
  showMessage(`ğŸ‰ æ’ƒç ´ï¼<br>â± ${t}s<br>ğŸ’° +${reward}`,2500);
 }
};

/* ===== ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥ï¼ˆç°¡æ˜“ï¼‰ ===== */
function startRush(){
 showMessage("ğŸ”¥ ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã¯ä»Šå¾Œæ‹¡å¼µäºˆå®š ğŸ”¥",2000);
}
</script>
</body>
</html>
